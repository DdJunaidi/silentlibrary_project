{% extends "base.html" %}
{% block title %}Admin — Books{% endblock %}
{% block content %}
<main class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 m-0">Manage Books</h1>
  <div class="d-flex gap-2">
    <a href="{% url 'admin_export_books_csv' %}" class="btn btn-outline-secondary">
      Export CSV
    </a>
    <a href="{% url 'admin_book_create' %}" class="btn btn-primary">Add Books</a>
  </div>
</div>


  <form class="row g-2 mb-3" method="get">
    <div class="col-md-6">
      <input type="search" name="q" value="{{ q }}" class="form-control" placeholder="Search title, author, genre…">
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-secondary w-100">Search</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Title</th><th>Author</th><th>Genre</th><th>Available</th><th>Created</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for b in books %}
        <tr>
          <td>{{ b.bookTitle }}</td>
          <td>{{ b.bookAuthor }}</td>
          <td>{{ b.get_bookGenre_display|default:b.bookGenre }}</td>
          <td>{{ b.is_available|yesno:"Yes,No" }}</td>
          <td>{{ b.created_at|date:"Y-m-d H:i" }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_book_update' b.pk %}">Edit</a>
            <form class="d-inline" method="post" action="{% url 'admin_book_delete' b.pk %}">
              {% csrf_token %}
              <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this book?')">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-muted">No books found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if books.has_other_pages %}
  <nav aria-label="Books pagination">
    <ul class="pagination">
      {% if books.has_previous %}
      <li class="page-item"><a class="page-link" href="?q={{ q }}&page={{ books.previous_page_number }}">Previous</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      <li class="page-item disabled"><span class="page-link">Page {{ books.number }} of {{ books.paginator.num_pages }}</span></li>

      {% if books.has_next %}
      <li class="page-item"><a class="page-link" href="?q={{ q }}&page={{ books.next_page_number }}">Next</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</main>
{% endblock %}
